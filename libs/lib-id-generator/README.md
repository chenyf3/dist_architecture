# 分布式id生成器
基于美团分布式ID生成服务改造而来：https://github.com/Meituan-Dianping/Leaf 

## 功能说明
1. 支持数据库分段发号
2. 支持redis发号，包括分段发号和自增id发号
3. 支持雪花算法，支持zk上报节点数据和redis上报节点数据

## 各发号器使用说明
### 数据库分段发号
1. 使用数据库分段发号，能够保证id单调自增，系统会根据并发量自动调整步长，可支撑百万级别的TPS
2. 如果应用重启或宕机，存在id区间不连续的情况，有多大的区间不连续取决于应用中预加载的id数量
3. 单点故障和数据一致性问题依赖于数据库的高可用方案
4. 如果需要获取id的biz_key在内存中不存在，会自动添加到数据库并加载到内存
5. 默认开启懒加载模式，即只有在使用到某个key的时候才会从数据库加载到内存，当然也可以关闭此模式，这样应用启动时会自动把数据库中的所有的记录加载到内存中，
后台线程也会每分钟从数据库同步一次数据，不过，如果数据比较多，加载时间会比较久

### redis分段发号
1. 使用redis分段发号，能够保证id单调自增，系统会根据并发量自动调整步长，可支撑百万级别的TPS
2. 如果应用重启或宕机，存在id区间不连续的情况，有多大的区间不连续取决于应用中预加载的id数量
3. 单点故障和数据一致性问题依赖于redis本身的集群方案
4. 如果需要获取id的biz_key在内存中不存在，会自动添加到redis并加载到内存
5. 如果希望消除id区间不连续的情况，也可以配置segmentExcludes属性，这样，每次都会去redis服务端获取id，但性能比较差

### 雪花算法
1. 使用雪花算法，能够做到id趋势递增，可支撑百万级别的TPS，理论极限值是400W+的tps
2. 雪花算法需要指定workerId，支持zookeeper或redis自动生成workerId的方式
3. 如果是单机房部署，需要保证实例Id不能重复，并且同一个实例每次启动时的实例Id都一样，实例Id支持使用IP和域名两个方式
4. 如果是多机房部署，并且共用zookeeper或redis，需要保证每个机房的实例Id不能重复，即做到全局唯一，可以通过给不同机房分配不同IP网段或者不同的域名前缀(或后缀)等方式来实现
5. 如果是多机房部署，并且每个机房单独部署zookeeper或redis，则需要对workerId进行规划，比如A机房是0~100，B机房是101~200，以此类推，可以通过 
minWorkerId、maxWorkerId 两个JVM参数指定本机房的workerId区间范围，在启动时会自动进行集群初始化